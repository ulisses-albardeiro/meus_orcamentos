{% extends 'base.html' %}

{% block conteudo %}

<style>
    .botao {
        background-color: #373643;
    }

    .botao:hover {
        background-color: #373643e7 !important;

    }
</style>

<h3 class="text-center">Confira Seus Dados</h3>
<p style="margin-top: -15px;" class="text-danger text-center">Para alterar seus dados vá para a aba <a
        href="{{ url('profile') }}">Perfil</a></p>
<form action="{{ url('recibo/gerar') }}" method="get" target="_blank">

    <div class="card border-1 shadow-lg p-3">
        <div class="text-center mb-3">
            {% if usuario().img_logo %}
            <img src="{{ url('templates/assets/img/logos/'~usuario().img_logo) }}" class="img-fluid"
                style="max-height: 150px;">
            {% endif %}
        </div>
        <div class="row g-2 mb-3">
            <div class="col-4">
                <label class="form-label">Seu nome</label>
                <input required value="{{ usuario().nome }}" type="text" class="form-control form-control-sm"
                    name="nome_empresa">
            </div>
            <div class="col-4">
                <label class="form-label"> Seu Email</label>
                <input value="{{ usuario().email }}" type="email" class="form-control form-control-sm"
                    name="email-empresa">
            </div>
            <div class="col-4">
                <label class="form-label"> Seu Telefone</label>
                <input required value="{{ usuario().telefone }}" type="text" class="form-control form-control-sm"
                    name="tel-empresa">
            </div>
        </div>
        <div class="row g-2 mb-3">
            <div class="col-4">
                <label class="form-label">Seu CPF/CNPJ</label>
                <input value="{{ usuario().cnpj }}" type="text" class="form-control form-control-sm" name="doc-empresa"
                    id="cnpj-input" placeholder="00.000.000/0000-00" maxlength="18">
            </div>
            <div class="col-4">
                <label class="form-label"> Seu Facebook</label>
                <input value="{{ usuario().facebook }}" type="text" class="form-control form-control-sm"
                    name="facebook">
            </div>
            <div class="col-4">
                <label class="form-label"> Seu Instagram</label>
                <input value="{{ usuario().instagram }}" type="text" class="form-control form-control-sm"
                    name="instagram">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Seu Endereço</label>
            <input value="{{ usuario().endereco }}" type="text" class="form-control form-control-sm" name="end-empresa">
        </div>
    </div>

    <h3 class="text-center mt-4">Dados do cliente</h3>
    <p style="margin-top: -15px;" class="text-danger text-center">Campos com * são obrigatórios</p>

    <div class="card border-1 shadow-lg p-3">
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <label class="form-label">Nome*</label>
                <input required type="text" class="form-control form-control-sm" name="nome-cliente">
            </div>
            <div class="col-md-4">
                <label class="form-label">CPF/CNPJ*</label>
                <input required type="text" class="form-control form-control-sm" name="doc-cliente"
                    id="cnpj-input-cliente" placeholder="000.000.000-00 ou 00.000.000/0000-00">
            </div>
            <div class="col-md-4">
                <label class="form-label">Valor do Recibo*</label>
                <input required type="text" class="form-control form-control-sm valor-recibo" name="valor-recibo"
                    placeholder="R$ 0,00">
            </div>
        </div>
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <label class="form-label">Telefone</label>
                <input type="text" class="form-control form-control-sm" name="tel-cliente">
            </div>
            <div class="col-md-4">
                <label class="form-label">Email</label>
                <input type="email" class="form-control form-control-sm" name="email-cliente">
            </div>
            <div class="col-md-4">
                <label class="form-label">Endereço</label>
                <input placeholder="Rua, número da casa, Cidade/estado" type="text" class="form-control form-control-sm"
                    name="end-cliente">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Descrição do Serviço/Produto (Opcional)</label>
            <textarea class="form-control form-control-sm" name="descricao" rows="3"
                placeholder="Descrição do que está sendo pago..."></textarea>
        </div>
    </div>

    <div class="text-center my-4">
        <button type="submit" class="btn btn-sm botao text-white"><i style="color: #18cb96;" class="bi bi-receipt"></i>
            Gerar
            Recibo</button>
    </div>
</form>

<script>
    // Função para aplicar máscara monetária a um campo específico
    function aplicarMascaraMonetaria(campo) {
        if (!campo) return;

        campo.addEventListener('input', function (e) {
            // Remove todos os caracteres não numéricos
            let valor = this.value.replace(/[^\d]/g, '');

            // Se estiver vazio, define como vazio
            if (valor === '') {
                this.value = '';
                return;
            }

            // Converte para número com centavos
            valor = (parseInt(valor, 10) / 100);

            // Formata com 2 casas decimais e vírgula
            this.value = valor.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).replace('.', '~').replace(',', '.').replace('~', ',');
        });

        campo.addEventListener('blur', function () {
            let valor = this.value.replace(/[^\d]/g, '');

            if (!valor) {
                this.value = '';
                return;
            }

            valor = parseInt(valor, 10) / 100;

            // Formata como moeda brasileira completa
            this.value = valor.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        });

        // Formata inicialmente se houver valor
        if (campo.value) {
            campo.dispatchEvent(new Event('blur'));
        }
    }

    // Função para aplicar máscara de CPF/CNPJ
    function aplicarMascaraDocumento(campo) {
        if (!campo) return;

        campo.addEventListener('input', function (e) {
            let value = this.value.replace(/\D/g, '');

            // CPF (11 dígitos)
            if (value.length <= 11) {
                if (value.length > 3) {
                    value = value.substring(0, 3) + '.' + value.substring(3);
                }
                if (value.length > 7) {
                    value = value.substring(0, 7) + '.' + value.substring(7);
                }
                if (value.length > 11) {
                    value = value.substring(0, 11) + '-' + value.substring(11);
                }
                this.value = value.substring(0, 14);
            }
            // CNPJ (14 dígitos)
            else {
                if (value.length > 2) {
                    value = value.substring(0, 2) + '.' + value.substring(2);
                }
                if (value.length > 6) {
                    value = value.substring(0, 6) + '.' + value.substring(6);
                }
                if (value.length > 10) {
                    value = value.substring(0, 10) + '/' + value.substring(10);
                }
                if (value.length > 15) {
                    value = value.substring(0, 15) + '-' + value.substring(15);
                }
                this.value = value.substring(0, 18);
            }
        });
    }

    // Quando o DOM estiver completamente carregado
    document.addEventListener('DOMContentLoaded', function () {
        // Aplica máscara de documento
        aplicarMascaraDocumento(document.getElementById('cnpj-input'));
        aplicarMascaraDocumento(document.getElementById('cnpj-input-cliente'));

        // Aplica máscara monetária ao campo de valor
        aplicarMascaraMonetaria(document.querySelector('.valor-recibo'));
    });
</script>

{% endblock %}